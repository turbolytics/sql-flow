{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "commands": {
      "type": "array",
      "description": "List of SQL commands to execute before processing the pipeline.",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Name of the command for reference."
          },
          "sql": {
            "type": "string",
            "description": "SQL statements to execute."
          }
        },
        "required": [
          "name",
          "sql"
        ]
      }
    },
    "tables": {
      "type": "object",
      "description": "Predefined SQL tables used in the pipeline.",
      "properties": {
        "sql": {
          "type": "array",
          "description": "List of tables with their SQL definitions and management configurations.",
          "items": {}
        }
      }
    },
    "udfs": {
      "type": "array",
      "description": "List of User-Defined Functions (UDFs) to be used in SQL queries.",
      "items": {}
    },
    "pipeline": {
      "type": "object",
      "description": "Main pipeline configuration.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the pipeline."
        },
        "description": {
          "type": "string",
          "description": "Description of the pipeline."
        },
        "batch_size": {
          "type": "integer",
          "minimum": 1
        },
        "flush_interval_seconds": {
          "type": "integer",
          "minimum": 30
        },
        "source": {
          "type": "object",
          "description": "Configuration for the data source.",
          "properties": {},
          "required": [
            "type"
          ]
        },
        "handler": {
          "type": "object",
          "properties": {},
          "required": [
            "type",
            "sql"
          ]
        },
        "sink": {
          "type": "object",
          "properties": {},
          "required": [
            "type"
          ]
        },
        "on_error": {
          "type": "object",
          "description": "Global error handling strategy for the pipeline.",
          "properties": {
            "policy": {
              "type": "string",
              "enum": [
                "RAISE",
                "IGNORE",
                "DLQ"
              ],
              "default": "RAISE",
              "description": "Defines how errors should be handled."
            },
            "dlq": {
              "type": "object",
              "description": "Dead-letter queue configuration. Failed messages will be routed to this sink.",
              "properties": {},
              "required": [
                "type"
              ]
            }
          },
          "required": [
            "policy"
          ]
        }
      },
      "required": [
        "batch_size",
        "source",
        "handler",
        "sink"
      ],
      "additionalProperties": false
    }
  },
  "required": [
    "pipeline"
  ],
  "additionalProperties": false
}